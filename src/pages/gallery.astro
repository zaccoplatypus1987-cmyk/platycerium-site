---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout title="ギャラリー - Platycerium Collection">
  <style>
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .filter-active {
      background-color: #4A7C2F !important;
      color: white !important;
    }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>

  <Header />

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Sidebar Filters -->
      <aside class="lg:w-64 flex-shrink-0">
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
          <h2 class="text-xl font-bold mb-4">フィルター</h2>

          <!-- Category Filter -->
          <div class="mb-6">
            <h3 class="font-semibold mb-2">種類</h3>
            <div class="space-y-2" id="category-filters">
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="category" data-filter-value="all">
                すべて
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="category" data-filter-value="bifurcatum">
                ビフルカツム
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="category" data-filter-value="willinckii">
                ウィリンキー
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="category" data-filter-value="wandae">
                ワンダエ
              </button>
            </div>
          </div>

          <!-- Time Period Filter -->
          <div class="mb-6">
            <h3 class="font-semibold mb-2">投稿時期</h3>
            <div class="space-y-2" id="period-filters">
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="period" data-filter-value="all">
                すべて
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="period" data-filter-value="2025-05">
                2025年5月
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="period" data-filter-value="2025-04">
                2025年4月
              </button>
              <button class="filter-btn w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-colors"
                      data-filter-type="period" data-filter-value="2025-03">
                2025年3月
              </button>
            </div>
          </div>

          <!-- Clear Filters Button -->
          <button id="clear-filters" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded transition-colors">
            すべてクリア
          </button>
        </div>
      </aside>

      <!-- Gallery Grid -->
      <div class="flex-1">
        <div class="mb-6">
          <h2 class="text-2xl font-bold mb-2">ギャラリー</h2>
          <p class="text-gray-600" id="gallery-stats">読み込み中...</p>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="text-center py-12">
          <div class="inline-flex items-center gap-2 text-gray-600">
            <svg class="animate-spin h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-lg">投稿を読み込んでいます...</span>
          </div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden text-center py-12">
          <p class="text-xl text-red-600 mb-4"></p>
          <button onclick="location.reload()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
            再読み込み
          </button>
        </div>

        <!-- Gallery Container -->
        <div id="gallery-container">
          <!-- Posts will be rendered here -->
        </div>
      </div>
    </div>
  </main>

  <Footer />

  <!-- JavaScript -->
  <script type="module" src="/scripts/navigation.js"></script>
  <script type="module" src="/scripts/gallery-app.js"></script>
</BaseLayout>
