---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="åŸç¨®ç´¹ä»‹ - Platycerium Collection">
  <style is:global>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .hero-image {
      width: 100%;
      height: 400px;
      object-fit: cover;
      border-radius: 12px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .gallery-item {
      aspect-ratio: 1;
      overflow: hidden;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .gallery-item:hover {
      transform: scale(1.05);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .cultivar-card {
      background: #f9fafb;
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid #4A7C2F;
      margin-bottom: 1rem;
      transition: transform 0.2s ease;
      cursor: pointer;
    }

    .cultivar-card:hover {
      transform: translateX(4px);
      background: #f3f4f6;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }

    .breadcrumb-separator {
      color: #999;
    }

    .stat-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: #f0f7ed;
      color: #4A7C2F;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      margin-right: 1rem;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 0.75rem 0;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .feature-list li:last-child {
      border-bottom: none;
    }

    .feature-icon {
      color: #4A7C2F;
      flex-shrink: 0;
      margin-top: 0.25rem;
    }
  </style>

  <main class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="breadcrumb text-sm text-gray-600">
      <a href="/" class="hover:text-forest-mid transition-colors">ãƒ›ãƒ¼ãƒ </a>
      <span class="breadcrumb-separator">/</span>
      <a href="/gallery/" class="hover:text-forest-mid transition-colors">ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
      <span class="breadcrumb-separator">/</span>
      <span id="breadcrumb-current" class="text-forest-dark font-semibold">èª­ã¿è¾¼ã¿ä¸­...</span>
    </nav>

    <!-- Loading Indicator -->
    <div id="loading" class="text-center py-12">
      <div class="inline-flex items-center gap-2 text-gray-600">
        <svg class="animate-spin h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="text-lg">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</span>
      </div>
    </div>

    <!-- Error Message -->
    <div id="error" class="hidden text-center py-12">
      <p class="text-xl text-red-600 mb-4"></p>
      <a href="/gallery/" class="inline-block bg-forest-mid hover:bg-forest-dark text-white font-semibold py-2 px-6 rounded-lg transition-colors">
        ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«æˆ»ã‚‹
      </a>
    </div>

    <!-- Main Content -->
    <div id="content" class="hidden">
      <!-- Hero Section -->
      <div class="section-card fade-in">
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h1 id="species-title" class="text-4xl md:text-5xl font-bold text-forest-dark mb-2">
              èª­ã¿è¾¼ã¿ä¸­...
            </h1>
            <p id="species-subtitle" class="text-2xl text-gray-500 italic mb-4">
              <!-- å­¦å -->
            </p>
            <div class="mb-6">
              <span class="stat-badge">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span id="total-posts">0</span>ä»¶ã®æŠ•ç¨¿
              </span>
              <span class="stat-badge">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <span id="cultivar-count">0</span>å“ç¨®
              </span>
            </div>
            <div id="species-overview" class="text-gray-700 text-lg leading-relaxed">
              <!-- æ¦‚è¦ -->
            </div>
          </div>
          <div>
            <img id="hero-image" src="" alt="" class="hero-image" />
          </div>
        </div>
      </div>

      <!-- åŸç”£åœ°ãƒ»ç”Ÿæ¯åœ° -->
      <div class="section-card fade-in">
        <h2 class="text-2xl font-bold text-forest-dark mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          åŸç”£åœ°ãƒ»ç”Ÿæ¯åœ°
        </h2>
        <div id="origin-content" class="text-gray-700">
          <!-- åŸç”£åœ°æƒ…å ± -->
        </div>
      </div>

      <!-- ç‰¹å¾´ -->
      <div class="section-card fade-in">
        <h2 class="text-2xl font-bold text-forest-dark mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          ç‰¹å¾´
        </h2>
        <ul id="features-list" class="feature-list">
          <!-- ç‰¹å¾´ãƒªã‚¹ãƒˆ -->
        </ul>
      </div>

      <!-- é­…åŠ› -->
      <div class="section-card fade-in bg-gradient-to-br from-forest-light/10 to-white">
        <h2 class="text-2xl font-bold text-forest-dark mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
          </svg>
          é­…åŠ›
        </h2>
        <div id="charm-content" class="text-gray-700 text-lg">
          <!-- é­…åŠ›ã®èª¬æ˜ -->
        </div>
      </div>

      <!-- æ ½åŸ¹ã®ãƒã‚¤ãƒ³ãƒˆ -->
      <div class="section-card fade-in">
        <h2 class="text-2xl font-bold text-forest-dark mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg>
          æ ½åŸ¹ã®ãƒã‚¤ãƒ³ãƒˆ
        </h2>
        <ul id="cultivation-list" class="feature-list">
          <!-- æ ½åŸ¹ãƒã‚¤ãƒ³ãƒˆ -->
        </ul>
      </div>

      <!-- ä»£è¡¨çš„ãªå“ç¨® -->
      <div class="section-card fade-in">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-forest-dark flex items-center gap-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            ä»£è¡¨çš„ãªå“ç¨®
          </h2>
          <a id="all-cultivars-link" href="#" class="text-forest-mid hover:text-forest-dark transition-colors font-semibold flex items-center gap-1">
            ã™ã¹ã¦ã®å“ç¨®ã‚’è¦‹ã‚‹
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
        <div id="cultivars-list">
          <!-- ä»£è¡¨çš„ãªå“ç¨®ãƒªã‚¹ãƒˆ -->
        </div>
      </div>

      <!-- æŠ•ç¨¿ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
      <div class="section-card fade-in">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-forest-dark flex items-center gap-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            æœ€è¿‘ã®æŠ•ç¨¿
          </h2>
        </div>
        <div id="gallery-grid" class="gallery-grid">
          <!-- æŠ•ç¨¿ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
        </div>
      </div>
    </div>
  </main>

  <script is:inline type="module">
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰åŸç¨®IDã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const speciesId = urlParams.get('id');

    // åŸç¨®ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ—
    const speciesDataMap = {
      'willinckii': {
        nameJa: 'ã‚¦ã‚£ãƒªãƒ³ã‚­ãƒ¼',
        nameEn: 'P. bifurcatum subsp. willinckii',
        overview: 'ã‚¦ã‚£ãƒªãƒ³ã‚­ãƒ¼ï¼ˆP. bifurcatum subsp. willinckiiï¼‰ã¯ã€ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢ã®ã‚¸ãƒ£ãƒ¯å³¶ã€å°ã‚¹ãƒ³ãƒ€åˆ—å³¶ã€ã‚¹ãƒ©ã‚¦ã‚§ã‚·å³¶åŸç”£ã®ãƒ“ã‚«ã‚¯ã‚·ãƒ€ã§ã™ã€‚ä»¥å‰ã¯ç‹¬ç«‹ç¨®P. willinckiiã¨ã—ã¦åˆ†é¡ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯P. bifurcatumã®äºœç¨®ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚åœ’èŠ¸æ„›å¥½å®¶ã®é–“ã§é«˜ã„äººæ°—ã‚’èª‡ã‚Šã€å¤šæ•°ã®åœ’èŠ¸å“ç¨®ãŒä½œå‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚',
        origin: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢ã®ã‚¸ãƒ£ãƒ¯å³¶ã€å°ã‚¹ãƒ³ãƒ€åˆ—å³¶ï¼ˆãƒãƒªå³¶ãªã©ï¼‰ã€ã‚¹ãƒ©ã‚¦ã‚§ã‚·å³¶ã®ç†±å¸¯é›¨æ—ã«è‡ªç”Ÿã—ã¦ã„ã¾ã™ã€‚æ¨™é«˜ã®ä½ã„ç†±å¸¯é›¨æ—ã®æ¨¹æœ¨ã«ç€ç”Ÿã—ã€æ¸©æš–ã§æ¹¿åº¦ã®é«˜ã„ç’°å¢ƒã‚’å¥½ã¿ã¾ã™ã€‚',
        features: [
          'è²¯æ°´è‘‰ï¼ˆã‚·ãƒ¼ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ³ãƒ‰ï¼‰ã¯ç›´ç«‹ã—ã€ç¸ãŒæ·±ãåˆ‡ã‚Œè¾¼ã‚€ç‰¹å¾´çš„ãªå½¢çŠ¶',
          'èƒå­è‘‰ï¼ˆãƒ•ã‚¡ãƒ¼ã‚¿ã‚¤ãƒ«ãƒ•ãƒ­ãƒ³ãƒ‰ï¼‰ã¯ä¸‹å‚ã—ã€å¤šæ•°ã«åˆ†å²ã—ã¦2ãƒ¡ãƒ¼ãƒˆãƒ«ä»¥ä¸Šã«æˆé•·',
          'èƒå­åš¢ç¾¤ï¼ˆã‚¹ãƒã‚¢ãƒ‘ãƒƒãƒï¼‰ã¯è‘‰ã®å…ˆç«¯éƒ¨ã«å½¢æˆ',
          'å­æ ªï¼ˆãƒ—ãƒƒãƒ—ï¼‰ã‚’æ—ºç››ã«å‡ºã—ã€ç¾¤ç”Ÿã—ã‚„ã™ã„',
          'è‘‰è‰²ã¯æ·±ç·‘è‰²ã§ã€ç™½ã„æ˜ŸçŠ¶æ¯›ï¼ˆãƒˆãƒªã‚³ãƒ¼ãƒ ï¼‰ãŒç¾ã—ã„',
        ],
        charm: 'ã‚¦ã‚£ãƒªãƒ³ã‚­ãƒ¼ã®æœ€å¤§ã®é­…åŠ›ã¯ã€ãã®å¤šæ§˜æ€§ã¨æˆé•·ã®æ—©ã•ã§ã™ã€‚æ·±ãåˆ‡ã‚Œè¾¼ã‚“ã è²¯æ°´è‘‰ã®ç¾ã—ã„ãƒ•ã‚©ãƒ«ãƒ ã€é•·ãå‚ã‚Œä¸‹ãŒã‚‹èƒå­è‘‰ã®ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãªå§¿ã¯åœ§å·»ã§ã™ã€‚ã¾ãŸã€æ ½åŸ¹ãŒæ¯”è¼ƒçš„å®¹æ˜“ã§å­æ ªã‚’ã‚ˆãå‡ºã™ãŸã‚ã€åˆå¿ƒè€…ã‹ã‚‰ä¸Šç´šè€…ã¾ã§å¹…åºƒãæ¥½ã—ã‚ã¾ã™ã€‚æ§˜ã€…ãªåœ’èŠ¸å“ç¨®ãŒå­˜åœ¨ã—ã€è‘‰ã®å½¢çŠ¶ã‚„è‰²ã€ã‚µã‚¤ã‚ºãªã©ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ€§ãŒé«˜ã„ã®ã‚‚é­…åŠ›ã®ä¸€ã¤ã§ã™ã€‚',
        cultivation: [
          'æ˜ã‚‹ã„æ—¥é™°ã€œåŠæ—¥é™°ã§ç®¡ç†ï¼ˆç›´å°„æ—¥å…‰ã¯é¿ã‘ã‚‹ï¼‰',
          'é«˜æ¸©å¤šæ¹¿ã‚’å¥½ã‚€ï¼ˆæœ€ä½æ¸©åº¦12â„ƒä»¥ä¸Šã‚’ä¿ã¤ï¼‰',
          'æ°´è‹”ã§ã®æ¿ä»˜ã‘ãŒä¸€èˆ¬çš„ï¼ˆé€šæ°—æ€§ãŒé‡è¦ï¼‰',
          'æ˜¥ã€œç§‹ã¯é€±2ã€œ3å›ã€å†¬ã¯é€±1å›ç¨‹åº¦ã®çŒæ°´',
          'æ˜¥ã€œç§‹ã®æˆé•·æœŸã«æœˆ1ã€œ2å›ã®æ¶²è‚¥ã‚’ä¸ãˆã‚‹',
          'é¢¨é€šã—ã®è‰¯ã„ç’°å¢ƒã§æ ½åŸ¹ã™ã‚‹ã“ã¨ã§ç—…å®³è™«ã‚’äºˆé˜²',
        ],
      },
      // ä»–ã®åŸç¨®ã®ãƒ‡ãƒ¼ã‚¿ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
    };

    async function loadSpeciesIntro() {
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const content = document.getElementById('content');

      if (!speciesId) {
        loading.classList.add('hidden');
        error.classList.remove('hidden');
        error.querySelector('p').textContent = 'åŸç¨®IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
        return;
      }

      try {
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        const response = await fetch('/data/species-hierarchy-index.json');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        const speciesData = data.hierarchy.find(item => item.id === speciesId);

        if (!speciesData) {
          throw new Error(`åŸç¨® "${speciesId}" ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
        }

        const staticData = speciesDataMap[speciesId];
        if (!staticData) {
          throw new Error(`åŸç¨® "${speciesId}" ã®èª¬æ˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“`);
        }

        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
        document.title = `${staticData.nameJa} - åŸç¨®ç´¹ä»‹ - Platycerium Collection`;

        // Breadcrumbæ›´æ–°
        document.getElementById('breadcrumb-current').textContent = staticData.nameJa;

        // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
        document.getElementById('species-title').textContent = staticData.nameJa;
        document.getElementById('species-subtitle').textContent = staticData.nameEn;
        document.getElementById('total-posts').textContent = speciesData.totalPosts;
        document.getElementById('cultivar-count').textContent = speciesData.subSpeciesCount;
        document.getElementById('species-overview').textContent = staticData.overview;

        // ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒï¼ˆæœ€æ–°ã®æŠ•ç¨¿ç”»åƒã‚’ä½¿ç”¨ï¼‰
        if (speciesData.latestImage) {
          document.getElementById('hero-image').src = `/${speciesData.latestImage}`;
          document.getElementById('hero-image').alt = staticData.nameJa;
        }

        // åŸç”£åœ°
        document.getElementById('origin-content').textContent = staticData.origin;

        // ç‰¹å¾´ãƒªã‚¹ãƒˆ
        const featuresList = document.getElementById('features-list');
        featuresList.innerHTML = staticData.features.map(feature => `
          <li>
            <span class="feature-icon">âœ“</span>
            <span>${feature}</span>
          </li>
        `).join('');

        // é­…åŠ›
        document.getElementById('charm-content').textContent = staticData.charm;

        // æ ½åŸ¹ãƒã‚¤ãƒ³ãƒˆ
        const cultivationList = document.getElementById('cultivation-list');
        cultivationList.innerHTML = staticData.cultivation.map(point => `
          <li>
            <span class="feature-icon">ğŸŒ±</span>
            <span>${point}</span>
          </li>
        `).join('');

        // ä»£è¡¨çš„ãªå“ç¨®ï¼ˆä¸Šä½5å“ç¨®ï¼‰
        const topCultivars = speciesData.subSpecies ? speciesData.subSpecies.slice(0, 5) : [];
        const cultivarsList = document.getElementById('cultivars-list');
        cultivarsList.innerHTML = topCultivars.map(cultivar => `
          <div class="cultivar-card" onclick="window.location.href='/species/detail?id=${cultivar.id}'">
            <h3 class="font-bold text-forest-dark mb-1">${cultivar.displayName}</h3>
            <p class="text-sm text-gray-600">${cultivar.count}ä»¶ã®æŠ•ç¨¿</p>
          </div>
        `).join('');

        // ã™ã¹ã¦ã®å“ç¨®ã‚’è¦‹ã‚‹ãƒªãƒ³ã‚¯
        document.getElementById('all-cultivars-link').href = `/species/subspecies?parent=${speciesId}`;

        // æŠ•ç¨¿ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆæœ€æ–°12ä»¶ã®ç”»åƒï¼‰
        await loadGallery(speciesData);

        loading.classList.add('hidden');
        content.classList.remove('hidden');

      } catch (err) {
        console.error('ã‚¨ãƒ©ãƒ¼:', err);
        loading.classList.add('hidden');
        error.classList.remove('hidden');
        error.querySelector('p').textContent = `ã‚¨ãƒ©ãƒ¼: ${err.message}`;
      }
    }

    async function loadGallery(speciesData) {
      const galleryGrid = document.getElementById('gallery-grid');

      // å„å“ç¨®ã‹ã‚‰æœ€æ–°ã®ç”»åƒã‚’åé›†
      const allImages = [];
      if (speciesData.subSpecies) {
        for (const subspecies of speciesData.subSpecies) {
          if (subspecies.latestImage) {
            allImages.push({
              image: subspecies.latestImage,
              name: subspecies.displayName,
              id: subspecies.id
            });
          }
        }
      }

      // æœ€æ–°12ä»¶ã‚’è¡¨ç¤º
      const displayImages = allImages.slice(0, 12);

      galleryGrid.innerHTML = displayImages.map(item => `
        <div class="gallery-item" onclick="window.location.href='/species/detail?id=${item.id}'">
          <img src="/${item.image}" alt="${item.name}" loading="lazy" />
        </div>
      `).join('');
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', () => {
      loadSpeciesIntro();
    });
  </script>
</BaseLayout>
